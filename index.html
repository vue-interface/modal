<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title>Modal</title>
    </head>
    <body>
        <div id="app" class="container mx-auto mb-6">
            <h1 class="text-4xl mb-6">modal</h1>

            <h3 class="text-2xl mb-2">Alert</h3>

            <p class="mb-3">Alert modals have a single button to accept the notification.</p>

            <btn variant="primary" @click="() => $refs.alert.open()">Alert</btn>

            <modal ref="alert" title="Some Title" type="alert">
                Some Content
            </modal>

            <hr class="my-6">

            <h3 class="text-2xl mb-2">Confirmation</h3>

            <p class="mb-3">Confirmation modals have a two buttons, one to accept the notification, and another to deny it.</p>

            <btn variant="primary" @click="() => $refs.confirm.open()">Confirm</btn>

            <modal ref="confirm" title="Some Title" type="confirm" @confirm="onConfirm">
                Are you sure you want to do something?
            </modal>

            <hr class="my-6">
            
            <h3 class="text-2xl mb-2">Model with Custom Buttons</h3>

            <p class="mb-3">Modals can be defined using an array of button objects.</p>

            <btn variant="primary" @click="() => $refs.modalWithButtons.open()">Show Modal</btn>

            <modal
                ref="modalWithButtons"
                title="Some Title"
                :buttons="[{
                    name: 'dismiss',
                    label: 'Dismiss',
                    onClick: onClickDismiss
                }, {
                    name: 'cancel',
                    label: 'Cancel'
                }]"
                @cancel="onCancel"
                @dismiss="onDismiss"
                @close="onClose"
                @open="onOpen">
                Some Content
            </modal>

            <hr class="my-6">
            
            <h3 class="text-2xl mb-2">Alert</h3>

            <p class="mb-3">Use the plugin to programatically show an alert.</p>

            <btn @click="showAlert">Show Alert</btn><br>

            <hr class="my-6">
            
            <h3 class="text-2xl mb-2">Confirmation</h3>

            <p class="mb-3">Use the plugin to programatically show a confirmation.</p>
            
            <btn @click="showConfirmation">Show Confirmation</btn><br>

            <hr class="my-6">
            
            <h3 class="text-2xl mb-2">Modal with Custom Component</h3>

            <p class="mb-3">Use the plugin to show a modal with a custom component.</p>
            
            <btn @click="showCustomModal">Show Confirmation</btn><br>
        </div>

        <script type="module">
            import './index.css';
            import { h, createApp } from 'vue/dist/vue.esm-bundler';
            import { Btn } from '@vue-interface/btn';
            import { Modal, ModalPlugin } from './index.js';

            const PromptComponent = {
                props: {
                    label: String
                },
                data: () => ({
                    name: null
                }),
                render() {
                    return h('div', [
                        h('label', {
                            attrs: {
                                for: 'name',
                                class: 'pb-2'
                            }
                        }, this.label),
                        h('br'),
                        h('input', {
                            attrs: {
                                id: 'name',
                                class: 'border focus:ring-4 rounded outline-none px-2 py-1 w-full'
                            },
                            on: {
                                input: (event) => {
                                    this.name = event.target.value;
                                }
                            }
                        }),
                        h('div', 'Value: ' + this.name)
                    ]);
                }
            };

            const vue = createApp({
                components: {
                    Btn,
                    Modal
                },
                methods: {
                    showAlert() {
                        this.$modal.alert(
                            'Some Title',
                            'This is an alert.'
                        ).then(() => {
                            console.log('dismissed!');
                        });
                    },
                    showConfirmation() {
                        this.$modal.confirm(
                            'Some Title',
                            'Are you sure you want to do something?'
                        ).then(success => {
                            console.log('was confirmed: ', success);
                        });
                    },
                    showCustomModal() {
                        this.$modal.confirm(
                            'Custom Content',
                            h => h(PromptComponent, {
                                props: {
                                    label: 'test'
                                },
                                ref: 'content'
                            }), {
                                confirm(e, button, modal, resolve) {
                                    e.preventDefault();
                                    
                                    button.disabled = true;

                                    setTimeout(() => resolve(true), 1000);
                                }
                            }
                        ).then(success => {
                            console.log('was confirmed: ', success);
                        });
                    },
                    onClose(e, button, modal, resume) {
                        console.log('onClose');

                        e.preventDefault();

                        setTimeout(resume, 1000);
                    },
                    onConfirm(e, button, { close }) {
                        console.log('onConfirm');

                        e.preventDefault();

                        button.disabled = true;

                        setTimeout(close, 1000);
                    },
                    onCancel(e, button, { close }, resume) {
                        console.log('onCancel');

                        e.preventDefault();

                        button.disabled = true;
                        
                        setTimeout(resume, 1000);
                    },
                    onClickDismiss(e, button, { close }) {
                        console.log('onClickDismiss');

                        close();
                    },
                    onDismiss(e, button, modal, resume) {
                        console.log('onDismiss');

                        e.preventDefault();

                        button.disabled = true;
                        
                        setTimeout(resume, 1000);
                    },
                    onOpen(e, resume) {
                        console.log('onOpen');

                        e.preventDefault();

                        setTimeout(resume, 1000);
                    }
                }
            })
            .use(ModalPlugin)
            .mount('#app');
        </script>
    </body>
</html>
